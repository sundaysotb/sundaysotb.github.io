<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<script type="text/javascript" src="currency.js"></script>
	<script type="text/javascript" src="cookies.js"></script>
</head>
<body>
	<div id="confirmation-dialog">
		<div class="dialog-container">
			<div style="display: flex; height: 50%;">
				<div class="dialog-text">
					Are you sure you would like to clear this check?
				</div>
				<div class="close-dialog" onclick="cancelClear()">X</div>
			</div>
			<div class="dialog-button-container" style="display: flex; height: 50%;">
				<button class="dialog-button-delete" onclick="clearCheck()">Delete Check</button>
				<button class="dialog-button-cancel" onclick="cancelClear()">Cancel</button>
			</div>
		</div>
	</div>
	<div id="all-content-container">
		<div id="leftContentArea" class="item-selection" style="width:100vw; display: block;">
			<div class="tab">
				<button id="defaultTab" class="tablinks" onclick="openTab(event, 'Breakfast')">Breakfast</button>
				<button class="tablinks" onclick="openTab(event, 'Crepes')">Crepes</button>
				<button class="tablinks" onclick="openTab(event, 'Salads')">Salads</button>
				<button class="tablinks" onclick="openTab(event, 'Sandwiches')">Sandwiches</button>
				<button class="tablinks" onclick="openTab(event, 'Pasta')">Pasta</button>
				<button class="tablinks" onclick="openTab(event, 'Omelettes')">Omelettes</button>
				<button class="tablinks" onclick="openTab(event, 'Kids Menu')">Kids Menu</button>
				<button class="tablinks" onclick="openTab(event, 'Pizzas')">Pizzas</button>
				<button class="tablinks" onclick="openTab(event, 'Drinks')">Drinks</button>
				<button class="tablinks" onclick="openTab(event, 'Smoothies')">Smoothies</button>
				<button class="tablinks" onclick="openTab(event, 'Sides')">Sides</button>
			</div>
		</div>
		<div id="miscItemEditor" class="misc-item-editor" style="width: 100vw; display: none;">
			<div class="misc-item-editor-value-container">
				<div id="miscItemEditorValue" class='misc-editor-value-box'></div>
			</div>
			<div id="miscItemEditorNumberPad" class='buttonArea' style="height: 80% !important; display: none;  grid-template-columns: repeat(3, 33.3333%) !important;">
				<button class='misc-editor-button' style="background-color: red; border: 1px solid grey;" onclick="closeMiscEditor()">Cancel</button>
				<button class='misc-editor-button'></button>
				<button class='misc-editor-button' onclick='confirmMiscPriceButton()' style="background-color: #56d43f; border: 1px solid grey;">Confirm</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("1")'>1</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("2")'>2</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("3")'>3</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("4")'>4</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("5")'>5</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("6")'>6</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("7")'>7</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("8")'>8</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("9")'>9</button>
				<button class='misc-editor-button' onclick='clearMiscPriceNumber()'>Clear</button>
				<button class='misc-editor-button' onclick='miscPriceEditorNum("0")'>0</button>
				<button class='misc-editor-button' onclick='miscPriceBackspace()'>Back</button>
			</div>
			<div id="discountNumberPad" class='buttonArea' style="height: 80% !important; display: none; grid-template-columns: repeat(3, 33.3333%) !important;">
				<button class='misc-editor-button' style="background-color: red; border: 1px solid grey;" onclick="closeMiscEditor()">Cancel</button>
				<button class='misc-editor-button'></button>
				<button class='misc-editor-button' onclick='confirmDiscount()' style="background-color: #56d43f; border: 1px solid grey;">Confirm</button>
				<button class='misc-editor-button' onclick='discountEnterNum("1")'>1</button>
				<button class='misc-editor-button' onclick='discountEnterNum("2")'>2</button>
				<button class='misc-editor-button' onclick='discountEnterNum("3")'>3</button>
				<button class='misc-editor-button' onclick='discountEnterNum("4")'>4</button>
				<button class='misc-editor-button' onclick='discountEnterNum("5")'>5</button>
				<button class='misc-editor-button' onclick='discountEnterNum("6")'>6</button>
				<button class='misc-editor-button' onclick='discountEnterNum("7")'>7</button>
				<button class='misc-editor-button' onclick='discountEnterNum("8")'>8</button>
				<button class='misc-editor-button' onclick='discountEnterNum("9")'>9</button>
				<button class='misc-editor-button' onclick='clearDiscountNum()'>Clear</button>
				<button class='misc-editor-button' onclick='discountEnterNum("0")'>0</button>
				<button class='misc-editor-button' onclick='discountBackspace()'>Back</button>
			</div>
			<div id="enterPasscodePad" class='buttonArea' style="height: 80% !important; display: none; grid-template-columns: repeat(3, 33.3333%) !important;">
				<button class='misc-editor-button' style="background-color: red; border: 1px solid grey;" onclick="closeMiscEditor()">Cancel</button>
				<button class='misc-editor-button'></button>
				<button class='misc-editor-button' onclick='confirmPasscode()' style="background-color: #56d43f; border: 1px solid grey;">Confirm</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("1")'>1</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("2")'>2</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("3")'>3</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("4")'>4</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("5")'>5</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("6")'>6</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("7")'>7</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("8")'>8</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("9")'>9</button>
				<button class='misc-editor-button' onclick='passcodeClear()'>Clear</button>
				<button class='misc-editor-button' onclick='enterPasscodeNum("0")'>0</button>
				<button class='misc-editor-button' onclick='passcodeBackspace()'>Back</button>
			</div>
			<div id="miscItemLetters" class="buttonArea" style="height:80% !important; display: none;">
			
			</div>
		</div>
		<div id='payment-calculator' class="payment-calculator">
			<div class="check-controls">
				<div style="display: flex; height: 50%;">
					<button class="check-control-button" onclick="addMiscButton()">Add Misc.</button>
					<button class="check-control-button" onclick="saveTable()">Save Table</button>
					<button class="check-control-button" onclick="openPasscodePad()">Print Check</button>
					<button class="check-control-button" onclick="clearCheckDialog()">Clear</button>
				</div>
				<div style="display: flex; height: 50%">
					<button class="check-control-button" onclick="returnToTableView()">Cancel</button>
					<div id="tableNumDisplay" class="table-num-display">Table #</div>
				</div>
			</div>
			<div id="item-list" class="item-list">
				
			</div>
			<div id="totals" class="totals">
				<div class="discount-container" style="display: flex !important;">
				<div id="discountLabel" style="width: auto; height: 100%; font-size: 1.5em;">Discount: 0% (-$0.00)</div>
				<button style="width: 50px; height: 100%; margin-left: 5px;" onclick="openSetDiscountPercent()">Set</button>
				</div>
				<div style="display: flex; width: 100%; padding-top: 5px;">
					<div id="subtotal" class="total-part">
						Subtotal: $0.00
					</div>
					<div id="taxes" class="total-part">
						Taxes: $0.00
					</div>
					<div id="total" class="total-part" style="font-weight: bold;">
						Total: $0.00
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
<style>	
html, body {
  background-color: #ccc;
  touch-action: none;
}

html {
  height: 100%;
}

* {
  font-family: sans-serif;
}

body {
  height: 100%;
  display: flex;
  overflow: hidden;
}

.close-dialog {
  color: #aaaaaa;
  margin-top: 0px;
  margin-right: 5px;
  font-size: 4em;
  font-weight: bold;
}

.close-dialog:hover,
.close-dialog:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.dialog-button-container button {
  float: left;
  width: 50%;
  height: 100%;
  font-size: 2em;
}

.table-num-display {
  font-weight: bold;
  font-size: 2em;
  text-align: center;
  border: none;
  padding-top: 20px;
  background-color: ##f0f0f0;
  width: 75%;
}

.dialog-button-cancel {
	border: 1px solid #ebebeb;
	background-color: #ebebeb;
}

.dialog-button-delete { 
  color: white;
  background-color: #f44336;
  border: 1px solid red;
}

.discount-container {
  height: 40%;
  width: 60%;
  display: flex;
  display: table;
  margin: 0 auto;
  border: 1px solid black;
  background-color: white;
}

.dialog-text {
  width: 100%;
  font-size: 4em;
  margin-left: 5px;
}

* {
  font-size: 1.5vmin;
}

*, *::before, *::after {
  margin: 0;
  padding: 0;
}

#all-content-container {
  width: 100%;
  height: 100%;
  display: flex;
}

#confirmation-dialog {
  position: fixed;
  display: none;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0,0,0,0.5);
  z-index: 2;
}

.dialog-container {
  width: 80%;
  height: 35%;
  background-color: white;
  position: absolute; /*Can also be `fixed`*/
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  margin: auto;
  /*Solves a problem in which the content is being cut when the div is smaller than its' wrapper:*/
  max-width: 100%;
  max-height: 100%;
  overflow: hidden;
}

button {
  touch-action: manipulation !important;
}

.tab {
  height: 20%;
  width: 100%;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.misc-item-editor-value-container {
  height: 20%;
  width: 100%;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.misc-editor-value-box {
	width: 80%;
	height: 3em;
	font-size: 3em;
	background-color: white;
	margin-left: 10%;
	margin-right: 10%;
	margin-top: 1%;
	text-align: center;
}

.misc-editor-number-pad button {
  background-color: pink;
}

.tab button {
  background-color: inherit;
  border: none;
  outline: none;
  cursor: pointer;
  height: 50%;
  width: 16%;
  transition: 0.3s;
  font-weight: bold;
  font-size: 2em;
}

.tab button:hover {
  background-color: #ddd;
}

.tab button.active {
  background-color: #ccc;
}

.tabcontent {
  width: 100%;
  height: 80%;
  display: none;
  border: 1px solid #ccc;
  border-top: none;
  background-color: white;
}

.item-button {
  font-weight: bold;
  font-size: 1.5em;
  color: black;
  border: 1px solid;
  background-color: red;
}

.buttonArea {
  height: 100%;
  display: grid;
  grid-template-columns: repeat(4, 25%);
  padding-left: 2px;
  padding-right: 2px;
  grid-gap: 0px;
 }
 
.payment-calculator {
  width: 50vw;
  height: 100%;
  border-left: 1px solid #ccc;
  border-bottom: 1px solid #ccc;
  background-color: white;
  overflow: hidden;
}

.item-list {
  touch-action: manipulation;
  height: 70%;
  overflow-y: scroll;
  overflow-x: hidden;
}

.check-controls {
  height: 20%;
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.item-selection {
   height: 100%;
}

.misc-item-editor {
  height: 100%;
  border: 1px solid #ccc;
  background-color: white
}

.misc-editor-button {
  font-size: 3em;
  font-weight: bold;
}

.totals {
  width: 100%;
  height: 10%;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.total-part {
  font-size: 1.5em;
  text-align: center;
  width: 33.3%;
}

#item-list-name {
  padding: 0;
  margin: 0;
}

.removeButton {
  border: none;
  border-radius: 5%;
  width: 30px;
  background-color: red;  
  height: 35px;
  margin-top: 2.5px; 
  margin-left: 5px;
  color: white;
  font-weight: bold;
}

.item-entry-parent {
  display: flex;
  width: 100%;
  margin-top: 4px;
  padding: 0px;
  padding-right: 5ch;
  height: 40px;
}

.remove-button-parent {
  width: 35px;
  margin-right: 5px;
}

.item-entry-name {
  margin-top: 2.5px;
  text-align: left;
  font-size: 1.5em;
  height: 25px;
  width: 50%;
}

.check-control-button {
  width: 25%;
  height: 100%;
  border-radius: 1%;
  border: 1px solid #62b567;
  font-weight: bold;
  background-color: #6ac470;
}

.item-entry-price {
  text-align: right;
  margin-top: 2.5px;
  font-size: 1.5em;
  height: 25px;
  width: 25%;
}
</style>

<script>
	// Comments are for the weak (jk I wish I wrote comments but I'm in too deep now)
	// const socket = new WebSocket('ws://192.168.1.11:8194');
	
	var jsonData;
	var subtotal = currency("0");
	var taxes = '0.00';
	var total = '0.00';
	var itemList = new Map();
	var currId = 0;
	var tableId;
	var miscItemEditName;
	var miscPriceCurrencyValue = currency('0');
	var miscEditId;
	var discountPercent = '0';
	var discountAmount = currency('0');
	var passcode = "";
	
	loadJSON(function(json) {
		currId = 0;
		jsonData = JSON.parse(JSON.stringify(json));
		// , '#a5b3e8', '#6c7287', '#acd6a9', '#95a894'
		var colorPalettes = [['#72a6b3', '#5f777d', '#97ccaf', '#6f8c7c']];
		
		var leftContentArea = document.getElementById("leftContentArea");
		
		var categoryNum = 0;
		for(category in jsonData)
		{
			var colors = colorPalettes[categoryNum % colorPalettes.length];
			var text =  "";
			for(itemNum in jsonData[category])
			{
				var item = jsonData[category][itemNum];
				text += "<button id=\"" + item.Name + "-" + item.Price + "\"" + "class=\"item-button\"" + " style=\"background-color: " + colors[(2 * parseInt(itemNum)) % colors.length]
				+ "; border-color:" + colors[(1 + 2 * parseInt(itemNum)) % colors.length] +  ";\"" + "onClick=\"addItemButtonClick(this.id)\">" + item.Name + " - $" + item.Price + "</button>";
			}
			
			var categoryChild = document.createElement('div');
			categoryChild.id = category;
			categoryChild.style.display = "block";
			categoryChild.className = "tabcontent";
			
			var buttonArea = document.createElement('div');
			buttonArea.className = "buttonArea";
			buttonArea.id = category + "-Content";
			buttonArea.innerHTML = text;
			
			categoryChild.appendChild(buttonArea);
			leftContentArea.appendChild(categoryChild);
			categoryNum++;
		}
		
		openTab(null, 'Breakfast');
		document.getElementById('defaultTab').className += " active";
		
		tableId = GetURLParameter("table");
		loadTable();
		initializeMiscKeyboard();
	});
	
	function openSetDiscountPercent()
	{
		document.getElementById("discountNumberPad").style.display = "grid";
		document.getElementById('leftContentArea').style.display = 'none';
		document.getElementById('payment-calculator').style.display = 'none';
		document.getElementById('miscItemEditor').style.display = 'block';
		document.getElementById('miscItemEditorValue').innerHTML = discountPercent + "%";
	}
	
	function initializeMiscKeyboard()
	{
		var parent = document.getElementById("miscItemLetters");
		
		var cancel = document.createElement('button');
		cancel.className = 'misc-editor-button';
		cancel.innerHTML = 'Cancel';
		cancel.onclick = closeMiscEditor;
		cancel.style.backgroundColor = 'red';
		cancel.style.border = '1px solid grey';
		parent.appendChild(cancel);
		
		var capsLock = document.createElement('button');
		capsLock.className = 'misc-editor-button';
		capsLock.innerHTML = 'Caps Lock';
		capsLock.onclick = miscKeyboardCaseToggle;
		parent.appendChild(capsLock);
		
		var clear = document.createElement('button');
		clear.className = 'misc-editor-button';
		clear.innerHTML = 'Clear';
		clear.onclick = miscNameClear;
		parent.appendChild(clear);
		
		var confirm = document.createElement('button');
		confirm.className = 'misc-editor-button';
		confirm.innerHTML = 'Confirm';
		confirm.style.backgroundColor = '#56d43f';
		confirm.style.border = '1px solid grey';
		confirm.onclick = confirmMiscNameButton;
		parent.appendChild(confirm);
		
		for(var i = 65; i <= 90; i++)
		{
			if(i == 89)
			{	
				var spaceButton = document.createElement('button');
				spaceButton.className = 'misc-editor-button';
				spaceButton.innerHTML = 'Space';
				spaceButton.onclick = miscNameAddSpace;
				parent.appendChild(spaceButton);
			}
		
			var button = document.createElement('button');
			button.className = 'misc-editor-button';
			button.innerHTML = String.fromCharCode(i);
			button.id = button.innerHTML;
			button.onclick = miscNameAddLetter;
			
			parent.appendChild(button);
		}
				
		var backspaceButton = document.createElement('button');
		backspaceButton.className = 'misc-editor-button';
		backspaceButton.innerHTML = 'Backspace';
		backspaceButton.onclick = miscNameBackspace;
		parent.appendChild(backspaceButton);
	}
	
	function miscKeyboardCaseToggle()
	{
		var A = document.getElementById('A');
		var uppercase = false;
		
		if(A.innerHTML == 'A')
			uppercase = true;
		
		for(var i = 65; i <= 90; i++)
		{
			var button = document.getElementById(String.fromCharCode(i));
			
			// If uppercase, make lowercase
			if(uppercase)
			{
				button.innerHTML = String.fromCharCode(i + 32);
			}
			else 
			{
				button.innerHTML = String.fromCharCode(i);
			}
		}
	}
	
	function confirmPasscode()
	{
		closeMiscEditor();
		passcode = document.getElementById("miscItemEditorValue").innerHTML;
		print();
	}
	
	function miscNameClear()
	{
		document.getElementById('miscItemEditorValue').innerHTML = "";
	}
	
	function miscNameBackspace()
	{
		var currVal = document.getElementById('miscItemEditorValue').innerHTML;
		if(currVal.length == 0)
			return;
		document.getElementById('miscItemEditorValue').innerHTML = currVal.substring(0, currVal.length - 1);
	}
	
	function miscNameAddSpace()
	{
		document.getElementById('miscItemEditorValue').innerHTML += " ";
	}
	
	function enterPasscodeNum(num)
	{
		document.getElementById("miscItemEditorValue").innerHTML += num;
	}
	
	function passcodeBackspace()
	{
		if(document.getElementById("miscItemEditorValue").innerHTML.length > 0)
			document.getElementById("miscItemEditorValue").innerHTML = document.getElementById("miscItemEditorValue").innerHTML.substring(0, document.getElementById("miscItemEditorValue").innerHTML.length - 1);
	}
	
	function passcodeClear()
	{
		document.getElementById("miscItemEditorValue").innerHTML = "";
	}
	
	function openPasscodePad()
	{
		document.getElementById("miscItemEditorValue").innerHTML = "";
		document.getElementById("enterPasscodePad").style.display = "grid";
		document.getElementById('leftContentArea').style.display = 'none';
		document.getElementById('miscItemEditor').style.display = 'block';
		document.getElementById('miscItemLetters').style.display = 'none'; // The only thing visible would be the letters keyboard to enter the name
		document.getElementById('payment-calculator').style.display = 'none';
		document.getElementById('miscItemEditorNumberPad').style.display = 'none';
	}
	
	function confirmDiscount()
	{
		// The percent value is already saved in discountPercent, so this just closes the dialog and updates the total and cookie data
		closeMiscEditor();
		updateTotals();
	}
	
	function discountBackspace()
	{
		if(discountPercent.length == 1)
			discountPercent = '0';
		else
			discountPercent = discountPercent.substring(0, discountPercent.length - 1);
		document.getElementById('miscItemEditorValue').innerHTML = discountPercent + "%";
	}
	
	function discountEnterNum(number)
	{
		// Do not allow discount to go over 100%
		if(discountPercent.length == 2)
			return;
	
		if(number == '0' && discountPercent == '0')
		{
			return; // Don't let the user add trailing zeros or anything 
		}
		else if(discountPercent == '0')
			discountPercent = '';
		
		discountPercent += "" + number;
		document.getElementById('miscItemEditorValue').innerHTML = discountPercent + "%";
	}
	
	function clearDiscountNum()
	{
		discountPercent = '0';
		document.getElementById('miscItemEditorValue').innerHTML = discountPercent + "%";
	}
	
	function GetURLParameter(sParam)
	{
		var sPageURL = window.location.search.substring(1);
		var sURLVariables = sPageURL.split('&');
		for (var i = 0; i < sURLVariables.length; i++) 
		{
			var sParameterName = sURLVariables[i].split('=');
			if (sParameterName[0] == sParam) 
			{
				return sParameterName[1];
			}
		}
		
		return undefined;
	}
	
	function cancelClear()
	{
		document.getElementById("all-content-container").style.display = "block;";
		document.getElementById("confirmation-dialog").style.display = "none";
	}
	
	function clearCheckDialog()
	{
		document.getElementById("all-content-container").style.display = "none;";
		document.getElementById("confirmation-dialog").style.display = "block";
	}
	
	function saveTable()
	{
		var saveData = '';
		saveData += total + ",";
		saveData += subtotal + ",";
		saveData += taxes + ",";
		saveData += discountPercent + ","
		for(let [id, item] of itemList.entries())
		{
			var misc = 0;
			var currButton = document.getElementById(id + "-Button-" + item.split(":")[1]);
			
			if(currButton != undefined && currButton.dataset.misc == '1')
				misc = 1;
			saveData += item + ",";
		}
		setCookie(tableId, saveData, 365);
		returnToTableView();
	}
	
	function returnToTableView()
	{
		window.location.replace("/table-view.html");
	}
	
	function addItemButtonClick(buttonId)
	{
		var split = buttonId.split("-");
		addItem(split[0], split[1], currId, '0');
	}
	
	function addItem(name, price, idNum, misc)
	{
		var container = document.getElementById("item-list");
		var entry = document.createElement('div');
		entry.id = currId;
		entry.className = "item-entry-parent";
		entry.style.backgroundColor = '#ffc4c4';
		entry.innerHTML = "<div class=\"remove-button-parent\"><button class=\"removeButton\" id=\"" + currId + "-Button-" + price + "\"" + "onClick=\"removeItem(this.id)\">X</button></div>"
		+ "<div class=\"item-entry-name\" id=\"item-entry-name-" + currId + "\">" + name + "</div>"
		+ "<div class=\"item-entry-price\" id=\"item-entry-price-" + currId + "\">$" + price + "</div>";
		container.appendChild(entry);
		subtotal = subtotal.add(price + "");
		itemList.set(currId, name + ":" + price + ":" + idNum + ":" + misc);
		updateTotals();
		
		currId++;
	}
	
	function loadTable()
	{
		var tableCookie = getCookie(tableId);
		if(tableCookie != undefined)
		{
			var split = tableCookie.split(",");
			if(split.length < 4)
				return;
			
			discountPercent = split[3];
			
			for(itemNum in split)
			{
				var item = split[itemNum].split(":");
				if(item.length != 4) // This weeds out things like total, subtotal, taxes, etc...
					continue;
				var id = item[2];
				var misc = item[3]
				if(id > currId)
					currId = id + 1;
				if(misc == '0')
					addItem(item[0], item[1], item[2], item[3]);
				else
					addMisc(item[0], item[1], item[2], item[3]);
			}
		}
		
		document.getElementById('tableNumDisplay').innerHTML = "Table " + tableId;
	}
	
	function clearCheck()
	{
		cancelClear(); // Close clear dialog
		discountPercent = '0';
		document.getElementById("item-list").innerHTML = "";
		itemList.clear();
		updateTotals();
	}
	
	// Opens the mode to set 
	var openMiscEditMode = function () {
		miscEditId = this.id.split('-')[1];
		document.getElementById('leftContentArea').style.display = 'none';
		document.getElementById('miscItemEditor').style.display = 'block';
		document.getElementById('miscItemLetters').style.display = 'grid'; // The only thing visible would be the letters keyboard to enter the name
		document.getElementById('payment-calculator').style.display = 'none';
		document.getElementById('miscItemEditorNumberPad').style.display = 'none';
		// Start by setting the name displayed to the current name of the item
		document.getElementById('miscItemEditorValue').innerHTML = document.getElementById('item-entry-name-' + miscEditId).innerHTML;
	}
	
	var confirmMiscNameButton = function() {
		miscItemEditName = document.getElementById('miscItemEditorValue').innerHTML;
		document.getElementById('miscItemLetters').style.display = 'none';
		document.getElementById('miscItemEditorNumberPad').style.display = 'grid';
		miscPriceCurrencyValue = currency('0');
		document.getElementById('miscItemEditorValue').innerHTML = miscPriceCurrencyValue;
	}
	
	function confirmMiscPriceButton() {
		// Price is last, so after this is confirmed the changes are saveData
		
		closeMiscEditor();
		
		// Subtract the old misc price
		subtotal = subtotal.subtract(document.getElementById('item-entry-price-' + miscEditId).innerHTML.replace('$', ''));
		
		document.getElementById('item-entry-name-' + miscEditId).innerHTML = miscItemEditName;
		document.getElementById('item-entry-price-' + miscEditId).innerHTML = "$" + miscPriceCurrencyValue;
		
		for (let [key, value] of  itemList.entries()) {
			if(key == miscEditId)
			{
				itemList.set(key, miscItemEditName + ":" + miscPriceCurrencyValue + ":" + miscEditId + ":" + '1');
				break;
			}
		}
		
		subtotal = subtotal.add(miscPriceCurrencyValue);
		
		updateTotals();
	}
	
	function closeMiscEditor()
	{
		document.getElementById('leftContentArea').style.display = 'block';
		document.getElementById('enterPasscodePad').style.display = 'none';
		document.getElementById('miscItemEditor').style.display = 'none';
		document.getElementById('discountNumberPad').style.display = 'none';
		document.getElementById('miscItemLetters').style.display = 'none';
		document.getElementById('payment-calculator').style.display = 'block';
		document.getElementById('miscItemEditorNumberPad').style.display = 'none';
	}
	
	function print()
	{
		var message = "";
		message += passcode + ",";
		message += total + ",";
		message += subtotal + ",";
		message += taxes + ",";
		for(let item of itemList.values())
		{
			// Split the entry in item list because the format is [name]:[price]:[id]:[is misc] and only the name
			// and price are needed to print
			var split = item.split(':');
			message += split[0] + ":" + split[1] + ",";
		}
		
		// If there is a discount, add it as an item to send to print
		if(discountPercent != '0')
		{
			message += discountPercent + "% Discount:-" + discountAmount + ",";
		}
		
		// socket.send(message);
		window.location.replace("/table-view.html");
	}
		
	function addMiscButton()
	{
		addMisc('Misc. Side', '2.99');
	}
	
	function addMisc(itemName, itemPrice)
	{
		var container = document.getElementById("item-list");
		var entry = document.createElement('div');
		entry.id = currId;
		entry.className = "item-entry-parent";
		entry.style.backgroundColor = "#ffc4c4";
		
		var button = document.createElement('div');
		button.innerHTML = "<div class=\"remove-button-parent\"><button data-misc=\"1\" class=\"removeButton\" id=\"" + currId + "-Button-" + itemPrice + "\"" + "onClick=\"removeItem(this.id)\">X</button></div>"
		
		entry.appendChild(button);
		
		var name = document.createElement('div');
		name.id = 'item-entry-name-' + currId;
		name.className = 'item-entry-name';
		name.dataset.idNum = currId;
		name.innerHTML = itemName;
		
		entry.appendChild(name);
		
		var price = document.createElement('div');
		price.id = 'item-entry-price-' + currId;
		price.className = 'item-entry-price';
		price.innerHTML = "$" + itemPrice;
		entry.appendChild(price);
		container.appendChild(entry);
		
		var editButtonParent = document.createElement('div');
		editButtonParent.style.marginLeft = 'auto';
		editButtonParent.style.marginRight = '5px';
		
		var editButton = document.createElement('input');
		editButton.type = "image";
		editButton.id = "edit-" + currId;
		editButton.addEventListener("click", openMiscEditMode);
		editButton.src = "/edit_icon.png";
		editButton.style.width = '25px';
		editButton.style.height = '25px';
		editButton.onclick = openMiscEditMode;
		
		editButtonParent.appendChild(editButton);
		entry.appendChild(editButtonParent);
		
		itemList.set(currId, itemName + ":" + itemPrice + ":" + currId + ":" + 1);
		
		currId++;
		
		subtotal = subtotal.add(itemPrice);
		updateTotals();
	}
	
	function updateTotals()
	{
		// Recalculate the totals from everything in the itemsList (including the discount)
		// the subtotal is modified other places in the code. This is no longer necessary as it should
		// all be done here like this
		subtotal = currency('0'); // Completely reset subtotal
		discountAmount = currency('0');
		for (let [key, value] of  itemList.entries()) {
			subtotal = subtotal.add(value.split(':')[1]); // Add each item's price
		}
		
		var discountPercentDecimal = ".";
		// If the percent is single digit (i.e. 5%), we want the decimal value to be .05 and not .5 so a zero is added
		if(discountPercent.length == 1)
			discountPercentDecimal += "0";
		discountPercentDecimal += discountPercent;
		discountAmount = subtotal.multiply(discountPercentDecimal);
		subtotal = subtotal.subtract(discountAmount);
	
		taxes = subtotal.multiply(.1025);
		total = subtotal.add(taxes);
		document.getElementById("discountLabel").innerHTML = "Discount: " + discountPercent + "% (-$" + discountAmount + ")";
		document.getElementById("subtotal").innerHTML = "Subtotal: $" + subtotal;
		document.getElementById("taxes").innerHTML = " Taxes: $" + taxes;
		document.getElementById("total").innerHTML = " Total: $" + total + "";
	}
	
	function removeItem(buttonId)
	{
		var id = buttonId.split("-")[0];
		var oldPrice = document.getElementById("item-entry-price-" + id).innerHTML.replace('$', '');
		var entry = document.getElementById(id);
		entry.parentNode.removeChild(entry);
		
		subtotal = subtotal.subtract(oldPrice);
		
		for(let key of itemList.keys())
		{
			if(key == id)
				itemList.delete(key);
		}
		
		updateTotals();
	}
	
	function loadJSON(callback) {   
	  var xobj = new XMLHttpRequest();
	  xobj.overrideMimeType("application/json");
	  xobj.open('GET', '../Data.json', true);
	  xobj.onreadystatechange = function () {
		if (xobj.readyState == 4 && xobj.status == "200") {
		  callback(JSON.parse(xobj.responseText));
		}
	  };
	  xobj.send(null);  
	}
	
	function miscPriceEditorNum(number)
	{
		console.log("kajsflkajskfjklwjkerqw");
		var result = document.getElementById('miscItemEditorValue').innerHTML;
		
		miscPriceCurrencyValue = miscPriceCurrencyValue.multiply(10).add(".0" + number);
		
		result = '$' + miscPriceCurrencyValue;
		
		document.getElementById('miscItemEditorValue').innerHTML = result;
	}
	
	var miscNameAddLetter = function()
	{
		if(document.getElementById('miscItemEditorValue').innerHTML.length < 19)
			document.getElementById('miscItemEditorValue').innerHTML += this.innerHTML;
		else 
			alert("Name too long! There is a maximum of 19 characters because the receipt rolls are skinny :(");
	};
	
	function clearMiscPriceNumber(number)
	{
		miscPriceCurrencyValue = currency('0');
		document.getElementById('miscItemEditorValue').innerHTML = "$" + miscPriceCurrencyValue;
	}
	
	// Called when pressing back when setting the price for misc. items
	function miscPriceBackspace()
	{
		miscPriceCurrencyValue.intValue = Math.floor(miscPriceCurrencyValue.intValue / 10);
		document.getElementById('miscItemEditorValue').innerHTML = "$" + miscPriceCurrencyValue;
	}
	
	function openTab(event, tabName)
	{
	  var i, tabcontent, tablinks;
	  tabcontent = document.getElementsByClassName("tabcontent");
	  for (i = 0; i < tabcontent.length; i++) {
		tabcontent[i].style.display = "none";
	  }
	  tablinks = document.getElementsByClassName("tablinks");
	  for (i = 0; i < tablinks.length; i++) {
		tablinks[i].className = tablinks[i].className.replace(" active", "");
	  }
	  document.getElementById(tabName).style.display = "block";
	  if(event != undefined)
		event.currentTarget.className += " active";
	}
</script>

<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<script type="text/javascript" src="currency.js"></script>
</head>
<body>
	<div id="confirmation-dialog">
		<div class="dialog-container">
			<div style="display: flex; height: 50%;">
				<div class="dialog-text">
					Are you sure you would like to clear this check?
				</div>
				<div class="close-dialog" onclick="cancelClear()">X</div>
			</div>
			<div class="dialog-button-container" style="display: flex; height: 50%;">
				<button class="dialog-button-cancel" onclick="cancelClear()">Cancel</button>
				<button class="dialog-button-delete" onclick="clearCheck()">Delete Check</button>
			</div>
		</div>
	</div>
	<div id="all-content-container">
		<div id="leftContentArea" class="item-selection" style="width:70vw">
			<div class="tab">
				<button id="defaultTab" class="tablinks" onclick="openTab(event, 'Breakfast')">Breakfast</button>
				<button class="tablinks" onclick="openTab(event, 'Crepes')">Crepes</button>
				<button class="tablinks" onclick="openTab(event, 'Salads')">Salads</button>
				<button class="tablinks" onclick="openTab(event, 'Sandwiches')">Sandwiches</button>
				<button class="tablinks" onclick="openTab(event, 'Pasta')">Pasta</button>
				<button class="tablinks" onclick="openTab(event, 'Omelettes')">Omelettes</button>
				<button class="tablinks" onclick="openTab(event, 'Kids Menu')">Kids Menu</button>
				<button class="tablinks" onclick="openTab(event, 'Pizzas')">Pizzas</button>
				<button class="tablinks" onclick="openTab(event, 'Drinks')">Drinks</button>
				<button class="tablinks" onclick="openTab(event, 'Smoothies')">Smoothies</button>
				<button class="tablinks" onclick="openTab(event, 'Sides')">Sides</button>
			</div>
		</div>
		<div class="payment-calculator">
			<div class="check-controls">
				<button class="check-control-button" onclick="addMisc()">Add Misc.</button>
				<button class="check-control-button" onclick="">---</button>
				<button class="check-control-button" onclick="">---</button>
				<button class="check-control-button" onclick="clearCheckDialog()">Clear</button>
			</div>
			<div id="item-list" class="item-list">
			
			</div>
			<div id="totals" class="totals">
				<div id="subtotal" class="total-part">
					Subtotal: $0.00
				</div>
				<div id="taxes" class="total-part">
					Taxes: $0.00
				</div>
				<div id="total" class="total-part">
					Total: $0.00
				</div>
			</div>
		</div>
	</div>
</body>
</html>
<style>	
html, body {
  background-color: #ccc;
  touch-action: none;
}

html {
  height: 100%;
}

* {
  font-family: sans-serif;
}

body {
  height: 100%;
  display: flex;
  overflow: hidden;
}

.close-dialog {
  color: #aaaaaa;
  margin-top: 0px;
  margin-right: 5px;
  font-size: 4em;
  font-weight: bold;
}

.close-dialog:hover,
.close-dialog:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.dialog-button-container button {
  float: left;
  width: 50%;
  height: 100%;
  font-size: 2em;
}

.dialog-button-cancel {
  border: 1px solid black;
}

.dialog-button-delete { 
  color: white;
  background-color: #f44336;
  border: 1px solid red;
}

.dialog-text {
  width: 100%;
  font-size: 4em;
  margin-left: 5px;
}

* {
  font-size: 1.5vmin;
}

*, *::before, *::after {
  margin: 0;
  padding: 0;
}

#all-content-container {
  width: 100%;
  height: 100%;
  display: flex;
}

#confirmation-dialog {
  position: fixed;
  display: none;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0,0,0,0.5);
  z-index: 2;
}

.dialog-container {
  width: 80%;
  height: 25%;
  background-color: white;
  position: absolute; /*Can also be `fixed`*/
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  margin: auto;
  /*Solves a problem in which the content is being cut when the div is smaller than its' wrapper:*/
  max-width: 100%;
  max-height: 100%;
  overflow: hidden;
}

button {
  touch-action: manipulation;
}

.tab {
  height: 20%;
  width: 100%;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.tab button {
  background-color: inherit;
  border: none;
  outline: none;
  cursor: pointer;
  height: 50%;
  width: 16%;
  transition: 0.3s;
  font-weight: bold;
}

.tab button:hover {
  background-color: #ddd;
}

.tab button.active {
  background-color: #ccc;
}

.tabcontent {
  width: 100%;
  height: 80%;
  display: none;
  border: 1px solid #ccc;
  border-top: none;
  background-color: white;
}

.item-button {
  font-weight: bold;
  color: black;
  border: 1px solid;
  background-color: red;
}

.buttonArea {
  height: 100%;
  display: grid;
  grid-template-columns: repeat(4, 25%);
  padding-left: 2px;
  padding-right: 2px;
  grid-gap: 0px;
 }
 
.payment-calculator {
  width: 50vw;
  height: 100%;
  border-left: 1px solid #ccc;
  border-bottom: 1px solid #ccc;
  background-color: white;
  overflow: hidden;
}

.item-list {
  touch-action: manipulation;
  height: 85%;
  overflow-y: scroll;
}

.check-controls {
  height: 10%;
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.item-selection {
   height: 100%;
}

.totals {
  width: 100%;
  height: 5%;
  padding-top: 2px;
  display: flex;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.total-part {
  text-align: center;
  width: 33.3%;
}

#item-list-name {
  padding: 0;
  margin: 0;
}

.removeButton {
  border: none;
  border-radius: 5%;
  width: 25px;
  background-color: red;  
  height: 20px;
  margin-top: 2.5px; 
  margin-left: 2px;
  color: white;
  font-weight: bold;
}

.item-entry-parent {
  display: flex;
  margin-top: 2px;
  padding: 0px;
  padding-right: 5ch;
  height: 25px;
}

.remove-button-parent {
  width: 35px;
  margin-right: 5px;
}

.item-entry-name {
  padding-top: 2px;
  text-align: left;
  height: 25px;
  width: 100%;
}

.check-control-button {
  width: 24%;
  height: 100%;
  border-style: solid;
  border-radius: 1%;
  border-color: #6aab6e;
  background-color: #6ac470;
}

.item-entry-price {
  right: 5ch;
  height: 25px;
  text-align: left;
  margin-top: 2.5px;
  height: 25px;
}

.misc-name-input {
  width: 20ch;
  height: 15px;
  margin-top: 2.5px;  
  border: 1px solid black;
  margin-left: 2px;
}

.misc-price-input {
  width: 8ch;
  border: 1px solid black;
  height: 15px;
  margin-top: 2.5px;
  text-align: center;
}
</style>

<script>
	var jsonData;
	var subtotal;
	var currId;
	loadJSON(function(json) {
		currId = 0;
		jsonData = JSON.parse(JSON.stringify(json));
		// , '#a5b3e8', '#6c7287', '#acd6a9', '#95a894'
		var colorPalettes = [['#72a6b3', '#5f777d', '#97ccaf', '#6f8c7c']];
		
		var leftContentArea = document.getElementById("leftContentArea");
		
		var categoryNum = 0;
		for(category in jsonData)
		{
			var colors = colorPalettes[categoryNum % colorPalettes.length];
			var text =  "";
			for(itemNum in jsonData[category])
			{
				var item = jsonData[category][itemNum];
				text += "<button id=\"" + item.Name + "-" + item.Price + "\"" + "class=\"item-button\"" + " style=\"background-color: " + colors[(2 * parseInt(itemNum)) % colors.length]
				+ "; border-color:" + colors[(1 + 2 * parseInt(itemNum)) % colors.length] +  ";\"" + "onClick=\"addItem(this.id)\">" + item.Name + " - $" + item.Price + "</button>";
			}
			
			var categoryChild = document.createElement('div');
			categoryChild.id = category;
			categoryChild.style.display = "block";
			categoryChild.className = "tabcontent";
			
			var buttonArea = document.createElement('div');
			buttonArea.className = "buttonArea";
			buttonArea.id = category + "-Content";
			buttonArea.innerHTML = text;
			
			categoryChild.appendChild(buttonArea);
			leftContentArea.appendChild(categoryChild);
			categoryNum++;
		}
		
		subtotal = currency("0");
		
		openTab(null, 'Breakfast');
		document.getElementById('defaultTab').className += " active";
	});
	
	function cancelClear()
	{
		document.getElementById("all-content-container").style.display = "block;";
		document.getElementById("confirmation-dialog").style.display = "none";
	}
	
	function clearCheckDialog()
	{
		document.getElementById("all-content-container").style.display = "none;";
		document.getElementById("confirmation-dialog").style.display = "block";
	}
	
	function addItem(buttonId)
	{
		var split = buttonId.split("-");
		
		var container = document.getElementById("item-list");
		var entry = document.createElement('div');
		entry.id = currId;
		entry.innerHTML = "<div class=\"item-entry-parent\" style=\"background-color:#ffc4c4;\">" 
		+ "<div class=\"remove-button-parent\"><button class=\"removeButton\" id=\"" + currId + "-Button-" + split[1] + "\"" + "onClick=\"removeItem(this.id)\">X</button></div>"
		+ "<div class=\"item-entry-name\" id=\"" + currId + "-Name\">" + split[0] + "</div>"
		+ "<div style=\"position: relative;\"><div class=\"item-entry-price\" id=\"" + currId + "-Price\">$" + split[1] + "</div></div>"
		+ "</div>";
		container.appendChild(entry);
		subtotal = subtotal.add(split[1]);
		
		updateTotals();
		
		currId++;
	}
	
	function clearCheck()
	{
		cancelClear(); // Close clear dialog
		document.getElementById("item-list").innerHTML = "";
		subtotal = currency("0");
		updateTotals();
	}
		
	function addMisc()
	{
		var container = document.getElementById("item-list");
		var entry = document.createElement('div');
		entry.id = currId;
		entry.className = "item-entry-parent";
		entry.style.backgroundColor = "#ffc4c4";
		
		var button = document.createElement('div');
		button.innerHTML = "<div class=\"remove-button-parent\"><button class=\"removeButton\" id=\"" + currId + "-Button-" + "M" + "\"" + "onClick=\"removeItem(this.id)\">X</button></div>"
		
		entry.appendChild(button);
		
		var name = document.createElement('name');
		name.style.width = "100%";
		name.innerHTML = "<input class=\"misc-name-input\" value=\"Misc. Side\"/>";
		
		entry.appendChild(name);
		
		var price = document.createElement('price');
		price.innerHTML = "<input class=\"misc-price-input\" min=\"0\" value=\"2.99\" oninput=\"\" onchange=\"\"/>";
		price.addEventListener('input', onChangeMisc);
		price.oldvalue = '2.99';
		
		entry.appendChild(price);
		
		container.appendChild(entry);
		
		currId++;
		
		subtotal = subtotal.add('2.99');
		updateTotals();
	}
	
	function updateTotals()
	{
		document.getElementById("subtotal").innerHTML = "Subtotal: $" + subtotal;
		document.getElementById("taxes").innerHTML = " Taxes: $" + subtotal.multiply(.1025);
		document.getElementById("total").innerHTML = " <b>Total: $" + subtotal.add(subtotal.multiply(.1025)) + "</b>";
	}
	
	function onChangeMisc(element)
	{
		if(element.target.oldvalue != undefined)
		{
			subtotal = subtotal.subtract(element.target.oldvalue);
		}
		else if(element.target.oldvalue == undefined)
		{
			subtotal = subtotal.subtract('2.99');
		}
		
		element.target.oldvalue = element.target.value;
		subtotal = subtotal.add(element.target.value);
		
		updateTotals();
	}
	
	function removeItem(buttonId)
	{
		var id = buttonId.split("-")[0];
		var button = document.getElementById(buttonId);
		var entry = document.getElementById(id);
		entry.parentNode.removeChild(entry);
		
		subtotal = subtotal.subtract(buttonId.split("-")[2]);
		
		updateTotals();
	}
	
	function loadJSON(callback) {   
	  var xobj = new XMLHttpRequest();
	  xobj.overrideMimeType("application/json");
	  xobj.open('GET', '../Data.json', true);
	  xobj.onreadystatechange = function () {
		if (xobj.readyState == 4 && xobj.status == "200") {
		  callback(JSON.parse(xobj.responseText));
		}
	  };
	  xobj.send(null);  
	}
	
	function openTab(event, tabName)
	{
	  var i, tabcontent, tablinks;
	  tabcontent = document.getElementsByClassName("tabcontent");
	  for (i = 0; i < tabcontent.length; i++) {
		tabcontent[i].style.display = "none";
	  }
	  tablinks = document.getElementsByClassName("tablinks");
	  for (i = 0; i < tablinks.length; i++) {
		tablinks[i].className = tablinks[i].className.replace(" active", "");
	  }
	  document.getElementById(tabName).style.display = "block";
	  if(event != undefined)
		event.currentTarget.className += " active";
	}
</script>
